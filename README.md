# 基于MSPM0的智能时钟系统

这是一个基于TI MSPM0微控制器的多功能智能时钟系统，集成了实时时钟、闹钟、秒表、音乐播放和OLED显示等功能。本项目是武汉大学全国大学生电子设计大赛培训基础项目。

## 主要功能

### 1. **实时时钟功能**
- 24小时制/12小时制时间显示
- 年、月、日、星期显示
- 自动闰年计算
- 时间日期设置功能

### 2. **闹钟系统**
- 支持3个独立闹钟
- 可设置闹钟时间、音乐和启用状态
- 闹钟触发时播放音乐
- 音乐选择功能（目前支持3首音乐）

### 3. **秒表功能**
- 精确到毫秒的计时
- 启动/暂停/重置功能
- 最大计时99小时

### 4. **数据存储**
- 使用内部Flash模拟EEPROM
- 自动保存时间日期
- 手动保存功能
- 断电数据保护

### 5. **用户界面**
- 128×64 OLED显示屏
- 4×4矩阵键盘输入
- 多级菜单系统
- 中文显示支持

## 🔧 主要函数功能

### **时间相关函数**
- `updateTime()` - 更新时间（每秒调用）
- `updateDate()` - 更新日期
- `calculateWeekday()` - 计算星期几
- `display_time()` - 显示时间
- `display_day()` - 显示日期
- `display_weekday()` - 显示星期

### **闹钟相关函数**
- `check_alarms()` - 检查并触发闹钟
- `display_alarm_menu()` - 显示闹钟设置菜单
- `set_alarm_time()` - 设置闹钟时间
- `set_alarm_music()` - 设置闹钟音乐
- `display_select_alarm()` - 显示闹钟选择界面

### **秒表相关函数**
- `updateStopwatch()` - 更新秒表计时
- `display_stopwatch()` - 显示秒表界面
- `TIMER_1_INST_IRQHandler()` - 秒表定时器中断处理

### **存储相关函数**
- `saveTime()` - 手动保存时间日期
- `autoSave()` - 自动保存
- `EEPROM_TypeA_init()` - EEPROM初始化
- `EEPROM_TypeA_writeData()` - 写入数据到EEPROM

### **用户界面函数**
- `displayMenu()` - 显示主菜单
- `displayTimeForm()` - 显示时间格式选择
- `setTime()` - 设置时间
- `setDate()` - 设置日期
- `OLED_ShowString()` - 显示字符串
- `OLED_ShowChar()` - 显示字符
- `OLED_Clear()` - 清屏

### **键盘处理函数**
- `KeySCInput()` - 扫描键盘输入
- `keyToDigit()` - 键值转数字

### **音乐播放函数**
- `playMusic()` - 播放音乐
- `BuzzON()` - 开启蜂鸣器
- `BuzzOFF()` - 关闭蜂鸣器

## 🛠️ 技术栈

### **硬件平台**
- **微控制器**: TI MSPM0系列
- **显示屏**: 128×64 OLED (SPI接口)
- **输入设备**: 4×4矩阵键盘
- **音频输出**: 蜂鸣器/PWM输出
- **存储器**: 内部Flash (EEPROM模拟)

### **软件架构**
- **实时系统**: 基于定时器中断的伪实时系统
- **状态机**: 使用状态机处理不同界面模式
- **模块化设计**: 各功能模块独立封装
- **中断驱动**: 定时器中断处理时钟更新

### **驱动库**
- **TI DriverLib**: TI官方驱动程序库
- **SPI驱动**: OLED显示屏通信
- **GPIO驱动**: LED和键盘控制
- **Timer驱动**: 定时器和PWM控制
- **Flash驱动**: EEPROM模拟和存储

### **关键特性**
1. **低功耗设计**: 利用MSPM0的低功耗特性
2. **稳定存储**: 使用Type A EEPROM模拟算法
3. **精确计时**: 基于定时器中断的精确时间基准
4. **响应式UI**: 实时刷新的用户界面
5. **模块化音乐系统**: 可扩展的音乐播放功能

## 构建说明

### **开发环境**
- Keil
- TI MSPM0 SDK
- TI Clang


### **编译步骤**
1. 导入项目到Keil
2. 配置目标设备（MSPM0G3519）
3. 设置正确的包含路径
4. 编译并下载到目标板(启是科技M0G3519开发板)

## 状态机设计

系统使用以下状态进行界面管理：
```c
typedef enum {
    TIME_DISPLAY,          // 时间显示模式
    MENU,                  // 主菜单
    SET_FORM,              // 时间格式设置
    STOPWATCH,             // 秒表模式
    ALARM_MENU,            // 闹钟菜单
    ALARM_SETTING_STATE    // 闹钟设置
} SYSTEM_STATE;
```
## 中断处理
系统使用两个定时器：

TIMER_0: 1秒中断，更新时间、检查闹钟、自动保存

TIMER_1: 1ms中断，更新秒表计时

## 扩展性
可扩展功能
增加更多闹钟

添加倒计时功能

温度显示

蓝牙/Wi-Fi连接

语音报时

多语言支持

代码结构优化

使用面向对象思想重构

添加配置文件系统

实现事件驱动架构

